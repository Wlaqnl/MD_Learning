## 5장 딥러닝

`목표` 딥러닝에 대해 알아보고 TensorFlow와 함께 사용하면 편리한 각종 라이브러리 살펴보기



### 5-1 딥러닝 개요

> ### 딥러닝

* 머신러닝의 한 종류
* 여러 층을 가진 **신경망**을 사용해 머신러닝을 수행하는 것을 의미한다.
* 이미지 인식, 음성 인식 분야뿐만 아니라 자연 언어 처리 등의 다양한 분야에 활용되며 큰 성과를 내고 있다.
* 개념 자체는 1980년대부터 있었지만 현대에 와서 컴퓨터의 성능이 좋아지고 비즈니스적으로 크게 성공하면서 지금과 같이 주목받게 된 것이다.

* 기존의 이미지 인식과 딥러닝을 이용한 이미지 인식의 차이는 ??
  * **특징량 추출**
  * 지금까지는 인간이 하나하나 가르쳐야 했지만 딥러닝을 이용하면 **기계가 자동으로 특징을 학습**할 수 있다.



> ### 신경망

* 인간의 신경망을 본따 만든 네트워크 구조를 의미한다.
* 컴퓨터에게 학습 능력을 갖게 해서 여러 가지 문제를 해결하기 위한 접근 방법
* 여러 뉴런이 연결돼 있는 구조를 가지고 있는 망
* 입력층에 학습시키고 싶은 데이터를 입력하면 데이터들이 입력층, 중간층, 출력층을 지나며 처리가 일어나고 최종적인 결과가 출력된다.
* 이러한 신경망을 3개 이상 중첩하면 **깊은 신경망**(Deep Neural Network : DNN)이라고 부르는데 이를 활용한 기계 학습을 딥러닝이라고 부른다.
* 딥러닝은 **대량의 데이터를 입력해서 학습**시키고 학습이란 이러한 **뉴런의 접속 가중치를 조정**하는 것을 의미한다.



> ### 퍼셉트론(인공 뉴런)

* 프랑크 로젠블라트(Frank Rosenblatt)가 1957년에 제안한 초기 형태의 인공 신경망으로 다수의 입력으로부터 하나의 결과를 내보내는 알고리즘
* 퍼셉트론에 여러 가지 정보를 고려해서 **가중치**를 변경하다 보면 어떤 정도의 가중치가 좋은 결정을 내리는지 알 수 있다.
* 따라서, 이러한 퍼셉트론을 여러 개 조합하면 더 복잡한 것들을 판단할 수 있게 된다.





### 5-2 TensorFlow 설치하기

> ### TensorFlow(텐서 플로우)

* 구글이 오픈소스로 공개한 머신러닝 라이브러리
* **대규모 숫자 계산을 해주는 라이브러리**지만 영상 처리 라이브러리도 일부 있다.
* 다만 이미지 처리와 음향 처리 등을 할 때는 추가적으로 이미지 처리에 특화된 OpenCV 라이브러리 등과 함께 사용한다.
* Tensor - 다차원 행렬 계산을 의미한다.
  * 즉, **다차원 행렬 계산을 흐르게 한다**는 의미
* C++로 만들어진 라이브러리지만 파이썬을 사용해서 호출할 때 **오버헤드**(어떤 처리를 하기 위해 들어가는 간접적인 처리 시간 · 메모리 등)가 거의 없는 구조로 설계되어 있다.
  * 즉, 일단 계산식을 모두 만들어 놓고, 데이터를 하나하나 넣으며 실행하는 구조
  * 별도의 계산 서버를 따로 실행할 필요 없이 파이썬 프로세스 내부에서 곧바로 실행할 수 있지만 프로그램 실행에 시간이 약간 걸린다.





### 5-3 Jupyter Notebook

> ### Jupyter Notebook

* 웹 브라우저에서 사용하는 **대화형 파이썬 환경**
* 하나하나의 입력을 **셀**이라는 단위로 표현한다.
* 주석 또는 문서를 프로그램 사이에 삽입하는 기능도 제공한다.
* 파이썬 대화 환경보다 편리한 점은 **이미 실행된 내용을 변경하고 다시 실행할 수 있다.**
* <u>matplotlib</u>를 이용해 **데이터 시각화 결과**를 인라인 출력으로 곧바로 확인할 수 있다.





### 5-4 TensorFlow 기본

> ### TensorFlow

* 변수에 값을 대입하는 것도 **데이터 플로우 그래프로 표현**한다.
* 실제 머신러닝을 할 때는 학습할 매개변수를 이처럼 **변수에 저장해서 사용**한다.
* **플레이스홀더** : 템플릿처럼 값을 넣을 공간을 만들어두는 기능
  * 이를 이용하면 데이터 플로우 그래프를 구축할 때는 값을 넣지 않고 값을 담을 수 있는 그릇(플레이스홀더)만 만들어주고, 이후에 세션을 실행할 때 그릇에 값을 넣고 실행할 수 있다.
  * 선언에서 배열의 크기를 **None으로 설정하면 원하는 크기의 배열을 지정**해 연산할 수 있다.





### 5-5 TensorBoard로 시각화하기

> ### TensorBoard

* TensorFlow에 데이터의 흐름을 시각화하는 도구
* tb.name_scope() 메서드를 이용하면 처리를 스코프 단위로 분할할 수 있다





### 5-6 TensorBoard로 딥러닝하기

> ### 합성곱 신경망(Convolutional Neural Network : CNN)

* 입력층과 출력층 사이의 중간층에 **합성곱층**과 풀링층을 배치한 것
* 이미지 인식에서는 이미지를 흐리게 만들거나 경계를 강조하는 작업을 하는데, 이러한 조작을 신경망으로 하는 것
* 합성곱층과 풀링층에서는 해상도를 낮추거나 샘플링하는 처리를 계속 반복한다.



> ### 합성곱층

* 이미지의 특징을 추출할 때 사용한다.
* 입력 x의 일부분을 조금씩 자르면서 평활화와 윤곽선 검출 처리를 하며, 특징 맵 c를 추출하는 것
* 역할 
  * 주변의 값과 필터를 사용해 중앙에 있는 값을 변화시키는 것



> ### 풀링층

* 합성곱층으로 얻은 특징맵 c를 축소하는 층
* 특징을 유지한 상태로 축소하므로 위치 변경으로 인한 결과 변화를 막아준다.
* 축소 방법에는 각 특징의 최댓값을 사용하는 **최대 풀링**과 평균값을 사용하는 **평균 풀링**이 있다.



> ### 전결합층

* 각 층의 유닛을 결합한다.
* 합성곱층과 풀링층의 결과인 2차원 특징 맵을 1차원으로 전개하는 역할을 한다.
* 이때 활성화 함수 등을 함께 사용해 특징을 더 강조한다.





### 5-7 Keras로 다양한 딥러닝 해보기

> ### Keras

* 머신러닝 라이브러리 Theano와 TensorFlow를 래핑한 라이브러리

* 백엔드로 TensorFlow와 Theano 등을 사용하며, 다양한 알고리즘으로 머신러닝 프로그램을 만들 수 있게 해 준다.

* 귀찮은 처리 내용을 따로 작성하지 않아도 되어 머신러닝과 관련된 부분에만 집중해서 프로그램을 만들 수 있다.

* np_utils.to_cateforical() 메서드를 이용하면 굉장히 간단하게 레이블을 10차원 배열로 변환할 수 있다.

* 시퀀셜(직선적)로 딥러닝의 각 층을 add() 메서드로 추가한다. 

  * Tensorflow 코드와 비교했을 때 굉장히 간단하다는 것을 알 수 있다.

* Keras로 머신러닝을 수행할 때 Pandas 배열 데이터를 그대로 사용할 수 없기 때문에 Numpy 배열 데이터를 전달해야 한다.

* Pandas로 CSV 파일을 읽어 들이고 원하는 열을 ndarray 자료형으로 변환하는 방법

  * csv = pd.read_csv("<파일 이름>.csv")

    X = csv[["<열 이름1>", "<열 이름2>"]].as_matrix()



> ### 배치 크기

* 머신러닝을 수행할 때 굉장히 많은 양의 데이터를 사용하는데 뭔가를 하나 수정하려고 할 때 모든 데이터를 다시 처리하는 것은 굉장히 쓸데없는 일이다. 그래서 훈련 데이터를 **여러 개의 작은 배치로 나누어 매개변수를 수정**한다. 이때의 작은 배치 크기를 **미니 배치 크기** 또는 **배치 크기**라고 한다.





### 5-8 Pandas/NumPy 다루기

> ### Pandas/NumPy

* 고급 데이터 분석과 수치 계산 등의 기능을 제공하는 확장 모듈
* 두 라이브러리 모두 **C 언어**로 작성돼 있어 처리 속도가 파이썬 라이브러리보다 **빠르다.**
* 머신러닝 라이브러리에 따라 Pandas의 DataFrame을 지원하지 않는 경우가 있는데 그럴 때는 **NumPy형식으로 변환해야 한다.** 
  * **as_matrix()**를 이용하면 NumPy의 ndarray 자료형의 배열로 변환할 수 있다.
* Pandas
  * 데이터 분석 기능을 제공하는 라이브러리로서, CSV 파일 등의 데이터를 읽고 원하는 데이터 형식으로 변환해준다.
  * Pandas에서 사용하는 기본 데이터는 DataFrame이고 정의할 때는 2차원 리스트를 매개변수로 전달한다.
  * [매뉴얼 : pandas.pydata.org/pandas-docs/stable/](https://pandas.pydata.org/pandas-docs/stable/)
* NumPy 
  * 수치 계산을 효율적으로 하기 위한 모듈로서, 다차원 배열과 고수준의 수학 함수를 제공한다.
  * NumPy를 이용하면 여러 데이터를 한꺼번에 조작할 수 있다.