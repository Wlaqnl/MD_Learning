## 1장 크롤링과 스크레이핑

`목표`  크롤링과 스크레이핑 관련된 기술을 살펴보고, Docker를 이용한 파이썬 개발 환경 구축 방법 알아보기



### **1-1 데이터 다운로드하기**

> ### urllib

* URL을 다루는 모듈을 모아 놓은 패키지
* urllib 라이브러리를 사용하여 HTTP 또는 FTP를 사용해 데이터를 다운로드 할 수 있다.

* 그 중 urllib.request 모듈은 웹 사이트에 있는 데이터에 접근하는 기능을 제공하고 인증, 리다이렉트, 쿠키처럼 인터넷을 이용한 다양한 요청과 처리를 지원한다.

* 직접 파일을 다운로드할 때는 urllib.request 모듈에 있는 urlretrieve() 함수를 사용한다.

* urlopen()을 이용하면 곧바로 파일을 저장하는 것이 아니라 데이터를 파이썬 메모리 위에 올릴 수 있다.

* 매개변수로 간단한 숫자를 사용하면 복잡한 처리를 없이 곧바로 URL에 지정해서 사용해도 되지만 한국어 등이 포함돼어 있으면 반드시 URL 인코딩을 해야한다.





### 1-2 BeautifulSoup로 스크레이핑하기

> ### 스크레이핑

* 웹 사이트에서 데이터를 추출하고, 원하는 정보를 추출하는 것



> ### BeautifulSoup

* HTML과 XML을 분석해주는 라이브러리

* 주로 from bs4 import BeautifulSoup라고 사용한다.

* ex ) soup = BeautifulSoup(res, 'html.parser') 

* BeautifulSoup는 루트부터 하나하나 요소를 찾는 방법 말고도 id속성을 지정해서 요소를 찾는 find() 메서드라는 메서드를 제공한다.

* 여러 개의 태그를 한 번에 추출하고 싶을 때는 find_all() 메서드를 사용한다.

* 링크의 href 속성은 attrs['href']처럼 attrs 속성에서 추출한다.

* 설명 텍스트는 string 속성으로 추출한다.

* 자바스크립트 라이브러리인 jQuery처럼 CSS 선택자를 지정해서 원하는 요소를 추출하는 기능도 제공한다.
  * ex) soup.select_one(<선택자>), soup.select(<선택자>)



> ### **DOM(Document Object Model)**

* XML 또는 HTML의 요소에 접근하는 구조를 나타낸다.

* DOM 요소의 속성은 태그 이름 뒤에 있는 각 속성을 말한다.



`참고`)

**HTML** : HyperText Markup Language 웹을 이루는 가장 기초적인 요소

**CSS** : 웹 페이지의 외형과 표현을 서술

**JavaScript** : 웹 페이지의 기능과 동작을 서술

**XML** : Extensible Markup Language W3C에서 개발된, 다른 특수한 목적을 갖는 마크업 언어를 만드는 데 사용하도록 권장하는 다목적 마크업 언어

 

즉, **HTML**은 단순히 규칙에 따라 정해진 태그, 속성값으로 이루어진 언어이며,

**DOM**은 브라우저가 HTML 파싱한 후 생성되는 객체 모델로, document에 접근 가능한 API이다.





### 1-3 CSS 선택자

* F12를 눌러 CSS 선택자를 복사하고 싶으면 copy > copy selector를 누르면 된다.

* BeautifulSoup의 기능에 정규 표현식을 조합해서 요소를 추출할 수도 있는데

  정규 표현식을 사용하기 위해 re 모듈을 읽어 들이고 compile() 함수로 정규 표현식을 생성해 적용한다.





### 1-4 링크에 있는 것을 한꺼번에 내려받기

* <a> 태그가 상대 경로로 주어졌을 때 대상에 있는 것을 다운 받으러면 상대 경로를 절대 경로로 변환해야 한다.

* 상대 경로를 전개할 때는 urllib.parse.urljoin()을 사용한다.
* urljoin(base, path) : 첫번째 매개변수로 기본 URL, 두번째 매개변수로 상대 경로를 지정한다.

* 만약 상대 경로(path 매개변수)가 http:// 등으로 시작한다면 기본 URL을 무시하고, 두번째 매개변수에 지정한 URL을 리턴한다.

* 즉, urljoin() 함수를 사용하면 <a> 태그의 href 속성에 지정돼 있는 경로를 절대 경로로 쉽게 변환할 수 있다.

* HTML을 다운로드하고 싶으면 재귀적으로 HTML을 분석해야 한다.
  * 순서 ) HTML 분석 -> 링크 추출 -> 각 링크 대상에 다음과 같은 처리 -> 파일 다운 -> 파일이 HTML이면 다시 처음으로 돌아가서 실행